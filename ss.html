<!DOCTYPE html>
<html>
  <head>
    <title>Screen Sharing Example</title>
  </head>
  <body>
    <h1>ScreenSharing Example</h1>
    <p>Share this URL with the other peer:</p>
    <p id="shareableUrl"></p>
    <video id="localVideo" autoplay></video>
    <video id="remoteVideo" autoplay></video>
    <button id="shareScreen">Share Screen</button>

    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/0.3.2/peer.min.js"></script>-->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
      const peer = new Peer();

      peer.on("open", (id) => {
        const shareableUrlElement = document.getElementById("shareableUrl");
        shareableUrlElement.textContent = `${window.location.href}?peer=${id}`;
      });

      document.getElementById("shareScreen").addEventListener("click", () => {
        navigator.mediaDevices.getDisplayMedia({ video: true }).then((screenStream) => {
          const call = peer.call(peer.id, screenStream);
          call.on("stream", (remoteScreenStream) => {
            const remoteVideo = document.getElementById("remoteVideo");
            remoteVideo.srcObject = remoteScreenStream;
          });
        });
      });

      peer.on("call", (call) => {
        navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
          call.answer(stream);
          call.on("stream", (remoteScreenStream) => {
            const remoteVideo = document.getElementById("remoteVideo");
            remoteVideo.srcObject = remoteScreenStream;
          });
        });
      });
    </script>
  </body>
</html>
